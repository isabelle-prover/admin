---

- name: Install packages
  apt:
    state: present
    update_cache: yes
    name:
      - python3-pip
      - mariadb-server
      - slurmctld
      - slurmdbd

- name: Create slurmctld spool dir
  file: path=/var/spool/slurmctld state=directory owner=slurm group=slurm mode=0751

- name: Create slurmctld log dir
  file: path=/var/log/slurmctld state=directory owner=slurm group=slurm mode=0751

- name: Copy slurmdb conf
  template: src=slurmdbd.conf dest=/etc/slurm/slurmdbd.conf owner=slurm group=slurm mode=0600

- name: Enable slurm database daemon
  service: name=slurmdbd enabled=true state=restarted

- name: Enable slurm controller daemon
  service: name=slurmctld enabled=true state=restarted